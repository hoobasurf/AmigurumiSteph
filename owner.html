<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mes créations</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:Arial,sans-serif}

/* BODY */
body{
  background:url('Photoroom_20251212_143703.PNG') center/cover no-repeat fixed;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

/* VIEW BUTTONS */
#viewSelector{
  display:flex;
  justify-content:center;
  gap:14px;
  padding:14px;
}
#viewSelector button{
  padding:10px 18px;
  border-radius:20px;
  border:none;
  cursor:pointer;
  font-weight:bold;
}

/* CONTENT */
.center-zone{
  flex:1;
  overflow:auto;
}
#owner-list{
  padding:20px;
}

/* CARDS (TAILLE D’ORIGINE) */
.owner-item{
  width:240px;
  margin:10px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:8px;
}
.owner-item img{
  width:220px;
  height:220px;
  object-fit:contain;
  border:4px solid #b67385;
  background:#ffe6f0;
}
.owner-item p{
  font-weight:bold;
  color:#b84c6f;
}

/* VIEWS */
.carousel-view{display:flex;gap:30px;overflow-x:auto}
.grid-view{display:grid;grid-template-columns:repeat(auto-fill,240px);gap:24px}
.list-view{display:flex;flex-direction:column}
.list-view .owner-item{flex-direction:row}

/* SIDEBAR */
#sidebar{
  position:fixed;
  top:0;
  left:-220px;
  width:220px;
  height:100vh;
  background:rgba(255,230,240,0.95);
  padding:20px;
  transition:left .3s;
  z-index:1000;
}
#sidebar.sidebar-open{left:0}
#toggleSidebar{
  position:absolute;
  top:50%;
  right:-30px;
  width:30px;
  height:60px;
  background:#ffb6c1;
  border-radius:0 12px 12px 0;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}
#sidebar button{
  width:100%;
  margin-bottom:10px;
  padding:10px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}

/* ADD FORM */
#addForm{
  padding:14px;
  display:flex;
  gap:10px;
  justify-content:center;
}
#addForm input{padding:6px}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:2000;
}
.modal-box{
  background:white;
  padding:20px;
  border-radius:16px;
  max-width:90%;
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div id="sidebar">
  <div id="toggleSidebar">☰</div>
  <button onclick="setTheme('default')">Défaut</button>
  <button onclick="setTheme('girly')">Girly</button>
</div>

<!-- VIEW -->
<div id="viewSelector">
  <button onclick="setView('carousel')">Carrousel</button>
  <button onclick="setView('grid')">Grille</button>
  <button onclick="setView('list')">Liste</button>
</div>

<!-- ADD (CODE ORIGINAL CONSERVÉ) -->
<div id="addForm">
  <input id="name" placeholder="Nom">
  <input id="photo" type="file" accept="image/*">
  <button id="add">Ajouter</button>
</div>

<div class="center-zone">
  <div id="owner-list" class="carousel-view"></div>
</div>

<!-- MODAL COMMENTS -->
<div class="modal" id="commentModal" onclick="this.style.display='none'">
  <div class="modal-box" onclick="event.stopPropagation()">
    <h3>Commentaires</h3>
    <div id="commentList"></div>
    <input id="commentInput" placeholder="Commentaire">
    <button onclick="addComment()">Envoyer</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* ===== SUPABASE ===== */
const supabase = supabase.createClient(
  'https://tzrwnyserlflrirvhafb.supabase.co',
  'sb_publishable__7MMGWAcD78fCtWFz1nUhA_O-rJMbl-'
);

/* ===== BASE CODE (INTOUCHABLE) ===== */
const nameInput = document.getElementById('name');
const photoInput = document.getElementById('photo');
const addBtn = document.getElementById('add');
const list = document.getElementById('owner-list');

let creations = [];
let currentView = 'carousel';

addBtn.onclick = () => {
  const name = nameInput.value.trim();
  const file = photoInput.files[0];

  if (!name || !file) {
    alert("Merci de remplir le nom et choisir une photo !");
    return;
  }

  const reader = new FileReader();
  reader.onload = async (e) => {
    const imgUrl = e.target.result;

    const div = document.createElement('div');
    div.className = 'owner-item';
    div.innerHTML = `<p>${name}</p><img src="${imgUrl}">`;
    list.prepend(div);

    // sync Supabase (en arrière-plan)
    const path = Date.now()+'.webp';
    const blob = await (await fetch(imgUrl)).blob();
    await supabase.storage.from('photos').upload(path, blob);
    const { data } = supabase.storage.from('photos').getPublicUrl(path);
    await supabase.from('creations').insert({ name, image_url: data.publicUrl });

    nameInput.value='';
    photoInput.value='';
  };
  reader.readAsDataURL(file);
};

/* ===== VIEW ===== */
function setView(v){
  currentView=v;
  list.className=v+'-view';
}

/* ===== SIDEBAR ===== */
document.getElementById('toggleSidebar').onclick=
()=>document.getElementById('sidebar').classList.toggle('sidebar-open');

/* ===== THEME ===== */
function setTheme(t){
  if(t==='girly'){
    document.body.style.background='#fff0f7';
  }else{
    document.body.style.backgroundImage="url('Photoroom_20251212_143703.PNG')";
  }
}

/* ===== LOAD SUPABASE ===== */
async function load(){
  const { data } = await supabase.from('creations').select('*').order('created_at',{ascending:false});
  data.forEach(c=>{
    const d=document.createElement('div');
    d.className='owner-item';
    d.innerHTML=`<p>${c.name}</p><img src="${c.image_url}">`;
    list.appendChild(d);
  });
}
load();
</script>

</body>
</html>
