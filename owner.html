<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Owner ‚Äì Ajouter Cr√©ations</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Ajouter une cr√©ation</h1>

  <div class="owner-box">
    <input type="text" id="name" placeholder="Nom du projet">
    <input type="file" id="photo" accept="image/*">
    <button id="addBtn">Ajouter</button>
  </div>

  <h2>Liste des cr√©ations</h2>
  <div id="owner-list"></div>

  <!-- Firebase SDK via CDN -->
  <script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js"></script>

  <script>
    // ‚ö° Config Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAKUqhiGi1ZHIfZRwslMIUip8ohwOiLhFA",
      authDomain: "amigurumisteph.firebaseapp.com",
      projectId: "amigurumisteph",
      storageBucket: "amigurumisteph.appspot.com",
      messagingSenderId: "175290001202",
      appId: "1:175290001202:web:b53e4255e699d65bd4192b"
    };

    firebase.initializeApp(firebaseConfig);

    const db = firebase.firestore();
    const storage = firebase.storage();

    const addBtn = document.getElementById("addBtn");
    const nameInput = document.getElementById("name");
    const photoInput = document.getElementById("photo");
    const ownerList = document.getElementById("owner-list");

    // üî• Fonction Ajouter
    addBtn.onclick = async () => {
      const name = nameInput.value.trim();
      const file = photoInput.files[0];

      if (!name || !file) {
        alert("Merci de mettre un nom et choisir une photo !");
        return;
      }

      try {
        const storageRef = storage.ref("photos/" + Date.now() + "-" + file.name);
        await storageRef.put(file);
        const url = await storageRef.getDownloadURL();

        await db.collection("creations").add({
          name,
          imageUrl: url,
          createdAt: Date.now()
        });

        nameInput.value = "";
        photoInput.value = "";

        alert("Cr√©ation ajout√©e !");
      } catch (err) {
        console.error(err);
        alert("Erreur lors de l'ajout !");
      }
    };

    // üî• Affichage live c√¥t√© Owner
    db.collection("creations").orderBy("createdAt", "desc")
      .onSnapshot(snapshot => {
        ownerList.innerHTML = "";
        snapshot.docs.forEach(docu => {
          const data = docu.data();
          const div = document.createElement("div");
          div.className = "owner-item";
          div.innerHTML = `<strong>${data.name}</strong><br><img src="${data.imageUrl}" width="150">`;
          ownerList.appendChild(div);
        });
      });
  </script>
</body>
</html>
