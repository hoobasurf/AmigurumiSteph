<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Owner</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="icon-152.png">
<meta name="theme-color" content="#f2b7c9">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<style>
/* ======= RESET ======= */
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;font-family:'Comic Sans MS',cursive;overflow-x:hidden;}
body::before {
  content:"";
  position:fixed;
  top:0; left:0;
  width:100vw; height:100vh;
  background-image: url('Photoroom_20251223_114401.jpeg');
  background-size:cover;
  background-position:center;
  z-index:-1;
}

/* ======= PHOTO PROFIL ======= */
#ownerProfilePhoto{
  position:fixed;
  top:10px; right:10px;
  width:50px; height:50px;
  border-radius:50%;
  border:2px solid #b84c6f;
  display:none;
  object-fit:cover;
  z-index:15;
}

/* ======= SIDEBAR ======= */
#sidebar{
  position:fixed;
  top:0; left:-220px;
  width:220px; height:100vh;
  background:rgba(255,230,240,0.2);
  border-right:2px solid #b67385;
  padding:20px;
  transition:left .3s;
  z-index:10;
}
#sidebar.sidebar-open{left:0;}
#toggleSidebar{
  position:absolute; top:50%; right:-30px;
  width:30px; height:60px;
  background:#ffb6c1;
  border-radius:0 12px 12px 0;
  display:flex; justify-content:center; align-items:center;
  cursor:pointer; font-weight:bold;
}
#sidebar button{
  width:auto; padding:8px 16px;
  border-radius:16px; border:none;
  background:#ffb6c1; color:#fff;
  cursor:pointer; font-weight:bold;
  display:block; margin-top:10px;
}

/* ======= GRILLE CREATIONS ======= */
.center-zone{
  display:flex; justify-content:center; align-items:flex-start;
  padding-top:3.5cm; height:auto; overflow:hidden;
}
#visitor-list-container{
  display:flex; overflow-x:auto;
  scroll-snap-type:x mandatory;
  -webkit-overflow-scrolling:touch;
  justify-content:center; padding-left:1cm;
}
.page{
  display:grid;
  grid-template-columns: repeat(2,1fr);
  grid-template-rows: repeat(3,1fr);
  column-gap:3mm; row-gap:4mm;
  flex:0 0 auto;
  width: calc(2*200px + 3mm);
  height: calc(3*200px + 8mm);
  scroll-snap-align:center;
  padding:4mm;
  justify-content:center;
}
.visitor-item{
  position:relative; width:200px; height:200px;
  border-radius:12px; overflow:hidden;
  border:3px solid #fff;
  box-shadow:0 0 0 3px #f6c2d1,0 6px 14px rgba(0,0,0,0.25),inset 0 0 0 1px rgba(255,255,255,0.4);
  background:#ffe6f0;
}
.visitor-item img{
  width:100%; height:100%; object-fit:cover;
  border-radius:12px; cursor:pointer;
  display:block; z-index:2;
  filter: brightness(1.05) contrast(1.05) saturate(0.95);
  transition: filter 0.3s, transform 0.3s;
}
.visitor-item img:hover{ transform: scale(1.03); }
.visitor-item p{
  position:absolute; bottom:2px; width:100%;
  font-size:14px; color:#b84c6f;
  font-weight:bold; text-align:center;
  text-shadow:1px 1px 2px rgba(255,255,255,0.8);
  z-index:3;
}
.delete-btn{
  position:absolute; top:2px; right:2px;
  width:20px; height:20px; background:#ffb6c1;
  color:#fff; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-weight:bold; cursor:pointer; z-index:5; font-size:14px;
  transition: background 0.2s;
}
.delete-btn:hover{ background:#e94f9a; }

/* ======= MODALS ======= */
.modal{ position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; z-index:10001; }
.modal .modal-box{ background:#ffe6f0; padding:16px 24px; border-radius:20px; border:3px solid #b67385; display:flex; flex-direction:column; gap:10px; align-items:center; min-width:200px; font-family:'Comic Sans MS',cursive; }
.modal input{ padding:6px 12px; border-radius:10px; border:2px solid #b67385; width:100%; }
.modal button{ padding:6px 14px; border:none; background:#ffb6c1; color:#fff; border-radius:12px; cursor:pointer; font-weight:bold; width:100%; }
</style>
</head>
<body>

<!-- PHOTO PROFIL -->
<img id="ownerProfilePhoto" alt="Profil">

<!-- SIDEBAR -->
<div id="sidebar">
  <div id="toggleSidebar">â˜°</div>
  <button id="addBtn">Ajouter</button>
</div>

<!-- CONTENEUR CREATIONS -->
<div class="center-zone">
  <div id="visitor-list-container"></div>
</div>

<!-- MODAL AJOUT -->
<div id="addModal" class="modal">
  <div class="modal-box">
    <h2>Ajouter des photos</h2>
    <input id="photoName" placeholder="Nom du projet">
    <input type="file" id="multiPhoto" multiple>
    <button id="confirmAdd">Valider</button>
  </div>
</div>

<script type="module">

import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://jyhbamdcxmpveujjqjla.supabase.co",
  "sb_publishable_sqsxb-3Kl5o3-JQYv9kGFw_-g0EgwMa"
);

let currentUser = {
  prenom: localStorage.getItem('prenom') || '',
  photo: localStorage.getItem('photo') || ''
};

// ====== PHOTO PROFIL ======
const ownerProfilePhoto = document.getElementById('ownerProfilePhoto');

async function loadOwnerPhoto() {
  if (!currentUser.photo) return;

  try {
    const { data, error } = supabase.storage.from('images').getPublicUrl(currentUser.photo);
    if (error) return console.error(error);
    if (data?.publicUrl){
      ownerProfilePhoto.src = data.publicUrl + '?t=' + Date.now();
      ownerProfilePhoto.style.display = 'block';
      localStorage.setItem('photo', data.publicUrl);
    }
  } catch(e){ console.error(e); }
}

const storedPhoto = localStorage.getItem('photo');
if(storedPhoto){
  ownerProfilePhoto.src = storedPhoto + '?t=' + Date.now();
  ownerProfilePhoto.style.display = 'block';
}else{
  loadOwnerPhoto();
}

// ====== SIDEBAR ======
document.getElementById('toggleSidebar').onclick = () => document.getElementById('sidebar').classList.toggle('sidebar-open');

// ====== AJOUT ======
document.getElementById('addBtn').onclick = () => document.getElementById('addModal').style.display='flex';
document.getElementById('addModal').addEventListener('click', e => { if(e.target===document.getElementById('addModal')) document.getElementById('addModal').style.display='none'; });

document.getElementById('confirmAdd').onclick = async () => {
  const name = document.getElementById('photoName').value.trim();
  const files = document.getElementById('multiPhoto').files;
  if(!name || !files.length) return alert("Nom et photo requis");
  
  const paths = [], urls = [];
  for(let f of files){
    const path = `${Date.now()}_${f.name}`;
    const { error: upErr } = await supabase.storage.from('images').upload(path, f);
    if(upErr) continue;
    const { data } = supabase.storage.from('images').getPublicUrl(path);
    if(data?.publicUrl) urls.push(data.publicUrl);
    paths.push(path);
  }
  
  if(urls.length===0) return;
  
  await supabase.from('creations').insert([{name, image_path: paths[0], images: paths, likes: [], comments: []}]);
  document.getElementById('addModal').style.display='none';
  document.getElementById('photoName').value='';
  document.getElementById('multiPhoto').value='';
};

</script>
</body>
</html>
