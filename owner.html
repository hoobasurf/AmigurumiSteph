<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Owner</title>
<style>
/* === TON CSS INTACT === */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:'Comic Sans MS',cursive}
body{background:url('Photoroom_20251212_143703.PNG') center top / cover no-repeat fixed; overflow:hidden; display:flex; flex-direction:column;}
#viewSelector{display:flex; justify-content:center; gap:12px; margin-top:500px; margin-bottom:20px;}
#viewSelector button{background:#fff0f7; border:2px solid #b84c6f; color:#b84c6f; padding:8px 16px; border-radius:24px; cursor:pointer;}
.center-zone{flex:1; display:flex; justify-content:center; align-items:flex-start; width:100%; overflow:auto;}
#visitor-list{display:flex; justify-content:center; gap:16px; max-width:1200px;}
.visitor-item{text-align:center; cursor:pointer;}
.visitor-item img{width:220px; height:220px; object-fit:contain; border:4px solid #b67385; background:#ffe6f0;}
.visitor-item p{margin-top:8px; font-size:20px; color:#b84c6f; font-weight:bold;}
.carousel-view{flex-wrap:nowrap; overflow-x:auto; scroll-behavior:smooth;}
.carousel-view::-webkit-scrollbar{height:8px}
.carousel-view::-webkit-scrollbar-thumb{background:#b84c6f88;border-radius:20px}
.grid-view{flex-wrap:wrap;}
.list-view{flex-direction:column;}
.list-view .visitor-item{display:flex; align-items:center; gap:16px;}
.list-view .visitor-item img{width:140px; height:140px;}
#sidebar{position:fixed; top:0; left:-220px; width:220px; height:100vh; background:rgba(255,230,240,0.15); border-right:2px solid #b67385; padding:20px; transition:left .3s ease; z-index:10;}
#sidebar.sidebar-open{left:0}
#toggleSidebar{position:absolute; top:50%; right:-30px; width:30px; height:60px; background:#ffb6c1; color:#8b3a3a; border-radius:0 12px 12px 0; display:flex; justify-content:center; align-items:center; cursor:pointer; border:1px solid #b67385; font-weight:bold;}
#sidebar button{width:100%; margin-bottom:10px; padding:10px; border:none; border-radius:12px; background:#ffb6c1; color:#8b3a3a; font-weight:bold; cursor:pointer;}
.snow{position:fixed; inset:0; pointer-events:none; z-index:5; display:none;}
.modal-bg{position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; justify-content:center; align-items:center; z-index:9999;}
.modal-box{background:#ffe6f0; border:4px solid #b67385; border-radius:18px; padding:20px; text-align:center;}
.modal-box button{width:100%; margin:8px 0; padding:10px; border:none; border-radius:12px; background:#ffb6c1; color:#8b3a3a; font-weight:bold;}
#sidebar,#sidebar *{pointer-events:auto;}
.snowflake{position:absolute; top:-10px; color:white; font-size:16px; animation:snowFall linear infinite; pointer-events:none;}
@keyframes snowFall{0%{transform:translateY(0)}100%{transform:translateY(110vh)}}
.candy{position:absolute; top:-20px; font-size:22px; animation:candyFall linear infinite; pointer-events:none;}
@keyframes candyFall{100%{transform:translateY(110vh) rotate(360deg)}}
</style>
</head>
<body>

<div id="snow" class="snow"></div>

<div id="viewSelector">
  <button id="btnCarousel">Carrousel</button>
  <button id="btnGrid">Grille</button>
  <button id="btnList">Liste</button>
</div>

<div class="center-zone">
  <div id="visitor-list"></div>
</div>

<div id="sidebar">
  <div id="toggleSidebar">‚ò∞</div>
  <input id="name" placeholder="Nom">
  <input id="photo" type="file" accept="image/*">
  <button id="add">Ajouter</button>
  <button id="themeBtn">Th√®me</button>
</div>

<div class="modal-bg" id="themeModal" onclick="closeThemeModal(event)">
  <div class="modal-box" onclick="event.stopPropagation()">
    <button onclick="setTheme('noel')">üéÑ No√´l</button>
    <button onclick="setTheme('default')">üí† D√©faut</button>
    <button onclick="setTheme('sweety')">üå∏ Sweety</button>
  </div>
</div>

<p id="status">üì§ Pr√™t √† uploader des images‚Ä¶</p>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

// --- Supabase ---
const SUPABASE_URL = "https://jyhbamdcxmpveujjqjla.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_sqsxb-3Kl5o3-JQYv9kGFw_-g0EgwMa";
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// --- Variables ---
let creations=[];
let currentView='grid';
const list=document.getElementById('visitor-list');
const nameInput=document.getElementById('name');
const photoInput=document.getElementById('photo');
const addBtn=document.getElementById('add');
const statusDiv=document.getElementById('status');
const themeBtn=document.getElementById('themeBtn');

// --- UI Event Attachments **avant async**
document.getElementById('btnCarousel').onclick=()=>setView('carousel');
document.getElementById('btnGrid').onclick=()=>setView('grid');
document.getElementById('btnList').onclick=()=>setView('list');
themeBtn.onclick=()=>openThemeModal();
document.getElementById('toggleSidebar').onclick=()=>document.getElementById('sidebar').classList.toggle('sidebar-open');

// --- UI Functions ---
function renderCreations(){
  list.innerHTML='';
  list.className=currentView+'-view';
  creations.forEach(c=>{
    const d=document.createElement('div');
    d.className='visitor-item';
    d.innerHTML=`<p>${c.name}</p><img src="${c.imgUrl}">`;
    list.appendChild(d);
  });
}

function setView(v){ currentView=v; renderCreations(); }
function openThemeModal(){ document.getElementById('themeModal').style.display='flex'; }
function closeThemeModal(){ document.getElementById('themeModal').style.display='none'; }

const snow=document.getElementById('snow');
const sweetRain=document.createElement('div');
sweetRain.style.position='fixed';
sweetRain.style.inset='0';
sweetRain.style.pointerEvents='none';
sweetRain.style.display='none';
document.body.appendChild(sweetRain);

function setTheme(t){
  snow.style.display='none';
  sweetRain.style.display='none';
  if(t==='noel'){ document.body.style.backgroundImage="url('noel.png')"; snow.style.display='block'; createSnow(); }
  else if(t==='sweety'){ document.body.style.backgroundImage="url('sweety-girly.png')"; sweetRain.style.display='block'; createCandy(); }
  else{ document.body.style.backgroundImage="url('Photoroom_20251212_143703.PNG')"; }
  closeThemeModal();
}

function createSnow(){ snow.innerHTML=''; for(let i=0;i<35;i++){ const f=document.createElement('div'); f.className='snowflake'; f.textContent='‚ùÑÔ∏è'; f.style.left=Math.random()*100+'%'; f.style.animationDuration=4+Math.random()*6+'s'; f.style.fontSize=12+Math.random()*14+'px'; snow.appendChild(f); } }
function createCandy(){ sweetRain.innerHTML=''; for(let i=0;i<35;i++){ const c=document.createElement('div'); c.className='candy'; c.textContent='üç¨'; c.style.left=Math.random()*100+'%'; c.style.animationDuration=4+Math.random()*6+'s'; sweetRain.appendChild(c); } }

// --- Async Functions ---
async function loadCreations(){
  const { data, error } = await supabase.from('creations').select('*').order('created_at',{ascending:false});
  if(error){ console.error(error); return; }
  creations = data.map(c=>({ name: c.name, imgUrl: c.main_image }));
  renderCreations();
}

addBtn.onclick=async()=>{
  const name=nameInput.value.trim();
  const file=photoInput.files[0];
  if(!name||!file){ alert("Nom + photo requis"); return; }

  const fileExt=file.name.split('.').pop();
  const fileName=`${Date.now()}.${fileExt}`;
  const filePath=`images/${fileName}`;
  statusDiv.textContent="üì§ Upload en cours‚Ä¶";

  const { data: uploadData, error: uploadError } = await supabase.storage.from('images').upload(filePath,file);
  if(uploadError){ statusDiv.textContent=`‚ùå Upload: ${uploadError.message}`; console.error(uploadError); return; }

  const { publicURL } = supabase.storage.from('images').getPublicUrl(filePath);
  if(!publicURL){ statusDiv.textContent="‚ùå Erreur r√©cup√©ration URL"; return; }

  const { error: insertError } = await supabase.from('creations').insert([{ name, main_image: publicURL, image_urls:[publicURL], public:true }]);
  if(insertError){ statusDiv.textContent=`‚ùå Insertion: ${insertError.message}`; console.error(insertError); return; }

  creations.unshift({ name, imgUrl: publicURL });
  renderCreations();
  nameInput.value=''; photoInput.value='';
  statusDiv.textContent="‚úÖ Cr√©ation ajout√©e !";
};

// --- Initial Load ---
loadCreations();
</script>
</body>
</html>
