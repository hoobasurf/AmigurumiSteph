<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Owner Admin</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:'Comic Sans MS',cursive;}
body{background:url('Photoroom_20251212_143703.PNG') center top / cover no-repeat fixed;display:flex;flex-direction:column;overflow:auto;}
header{text-align:center;padding:12px 0;}
#viewSelector{display:flex;justify-content:center;gap:12px;margin-top:50px;margin-bottom:20px;}
#viewSelector button{background:#fff0f7;border:2px solid #b84c6f;color:#b84c6f;padding:8px 16px;border-radius:24px;cursor:pointer;}
.center-zone{flex:1;display:flex;justify-content:center;align-items:flex-start;overflow:auto;}
#visitor-list{display:flex;gap:16px;padding:12px;}
.visitor-item{text-align:center;}
.visitor-item img{width:220px;height:220px;object-fit:contain;border:4px solid #b67385;background:#ffe6f0;}
.visitor-item p{margin-top:8px;font-size:20px;color:#b84c6f;font-weight:bold;}
#sidebar{position:fixed;top:0;left:-220px;width:220px;height:100vh;background:rgba(255,230,240,.9);border-right:2px solid #b67385;padding:20px;transition:left .3s;z-index:10;}
#sidebar.sidebar-open{left:0;}
#toggleSidebar{position:absolute;top:50%;right:-30px;width:30px;height:60px;background:#ffb6c1;border-radius:0 12px 12px 0;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:bold;}
.snow{position:fixed;inset:0;pointer-events:none;display:none;z-index:5;}
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;justify-content:center;align-items:center;}
.modal-box{background:#ffe6f0;padding:20px;border-radius:16px;}
.modal-box button{width:100%;margin:6px 0;}
</style>
</head>
<body>

<div id="snow" class="snow"></div>
<header></header>

<div id="viewSelector">
  <button id="btnCarousel">Carrousel</button>
  <button id="btnGrid">Grille</button>
  <button id="btnList">Liste</button>
</div>

<div class="center-zone">
  <div id="visitor-list"></div>
</div>

<!-- SIDEBAR -->
<div id="sidebar">
  <div id="toggleSidebar">â˜°</div>
  <h3>Ajouter une crÃ©ation</h3>
  <input id="name" placeholder="Nom">
  <input id="photo" type="file" accept="image/*">
  <button id="add">Ajouter</button>
  <hr>
  <button onclick="openThemeModal()">ThÃ¨me</button>
</div>

<!-- THEME -->
<div class="modal-bg" id="themeModal" onclick="closeThemeModal(event)">
  <div class="modal-box" onclick="event.stopPropagation()">
    <button onclick="setTheme('noel')">ðŸŽ„ NoÃ«l</button>
    <button onclick="setTheme('sweety')">ðŸŒ¸ Sweety</button>
    <button onclick="setTheme('default')">ðŸ’  DÃ©faut</button>
  </div>
</div>

<!-- Supabase JS -->
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

/* ===== SUPABASE ===== */
const supabase = createClient(
  "https://jyhbamdcxmpveujjqjla.supabase.co",
  "sb_publishable_sqsxb-3Kl5o3-JQYv9kGFw_-g0EgwMa"
);

let currentView = 'carousel';
const list = document.getElementById('visitor-list');
const addBtn = document.getElementById('add');
const nameInput = document.getElementById('name');
const photoInput = document.getElementById('photo');

// RÃ©cupÃ©rer les crÃ©ations existantes
async function loadCreations() {
  const { data, error } = await supabase.from('creations').select('*').order('created_at', { ascending:false });
  if(error){ alert(error.message); return; }
  render(data.map(c=>({
    name: c.name,
    imgUrl: supabase.storage.from('creations').getPublicUrl(c.image_path).data.publicUrl
  })));
}

// Afficher les crÃ©ations
function render(creations){
  list.innerHTML='';
  list.className=currentView+'-view';
  creations.forEach(c=>{
    const d=document.createElement('div');
    d.className='visitor-item';
    d.innerHTML=`<img src="${c.imgUrl}"><p>${c.name}</p>`;
    list.appendChild(d);
  });
}

// Vues
document.getElementById('btnCarousel').onclick = ()=>{currentView='carousel'; render([]); loadCreations();}
document.getElementById('btnGrid').onclick = ()=>{currentView='grid'; render([]); loadCreations();}
document.getElementById('btnList').onclick = ()=>{currentView='list'; render([]); loadCreations();}

// Ajouter une crÃ©ation
addBtn.onclick = async ()=>{
  if(!nameInput.value || !photoInput.files[0]) return alert("Remplis tout");
  const file = photoInput.files[0];
  const fileName = Date.now() + '_' + file.name;
  
  // Upload dans Supabase Storage
  const { data, error } = await supabase.storage.from('creations').upload(fileName, file);
  if(error){ alert(error.message); return; }

  // Ajouter dans la table
  const { error: errInsert } = await supabase.from('creations').insert([
    { name: nameInput.value, image_path: fileName }
  ]);
  if(errInsert){ alert(errInsert.message); return; }

  // Reset form + recharger
  nameInput.value='';
  photoInput.value='';
  loadCreations();
}

// Sidebar
document.getElementById('toggleSidebar').onclick = ()=>document.getElementById('sidebar').classList.toggle('sidebar-open');

// Theme
const themeModal = document.getElementById('themeModal');
const snow = document.getElementById('snow');
function openThemeModal(){themeModal.style.display='flex'}
function closeThemeModal(e){if(e.target===themeModal) themeModal.style.display='none'}
function setTheme(t){
  if(t==='noel'){document.body.style.backgroundImage="url('noel.png')"; snow.style.display='block';}
  else if(t==='sweety'){document.body.style.backgroundImage="url('sweety-girly.png')"; snow.style.display='none';}
  else{document.body.style.backgroundImage="url('Photoroom_20251212_143703.PNG')"; snow.style.display='none';}
}

// Charger au dÃ©part
loadCreations();
</script>
</body>
</html>
