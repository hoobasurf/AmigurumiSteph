<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Owner</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:url("Photoroom_20251223_114401.jpeg") center/cover fixed;
}

/* GALLERY */
#gallery{
  display:flex;
  gap:16px;
  padding:20px;
  overflow-x:auto;
}

/* CARD */
.card{
  min-width:200px;
  background:#fff;
  border-radius:18px;
  padding:10px;
  position:relative;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
  cursor:pointer;
}

.card img{
  width:100%;
  height:140px;
  object-fit:cover;
  border-radius:14px;
}

/* CROIX */
.delete-btn{
  position:absolute;
  top:8px;
  right:8px;
  width:26px;
  height:26px;
  border-radius:50%;
  background:#ff69b4;
  color:#fff;
  font-size:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

/* MODALS */
.modal-bg{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}

.modal-box{
  background:#fff;
  border-radius:20px;
  padding:20px;
  width:90%;
  max-width:420px;
  position:relative;
}

.close-modal{
  position:absolute;
  top:10px;
  right:14px;
  border:none;
  background:none;
  font-size:22px;
  cursor:pointer;
}

/* ZOOM */
#zoomImg{
  width:100%;
  height:260px;
  object-fit:contain;
  border-radius:14px;
}

#thumbs{
  display:flex;
  gap:10px;
  margin-top:10px;
  overflow-x:auto;
}

#thumbs img{
  width:60px;
  height:60px;
  object-fit:cover;
  border-radius:10px;
  cursor:pointer;
  opacity:.6;
}

#thumbs img.active{
  opacity:1;
  outline:2px solid #ff69b4;
}
</style>
</head>

<body>

<div id="gallery"></div>

<!-- ZOOM -->
<div id="zoomModal" class="modal-bg" onclick="closeZoom(event)">
  <div class="modal-box" onclick="event.stopPropagation()">
    <button class="close-modal" onclick="closeZoom()">×</button>
    <img id="zoomImg">
    <div id="thumbs"></div>
  </div>
</div>

<!-- DELETE -->
<div id="deleteModal" class="modal-bg" onclick="closeDelete(event)">
  <div class="modal-box" onclick="event.stopPropagation()">
    <button class="close-modal" onclick="closeDelete()">×</button>
    <h3>Supprimer cette image ?</h3>
    <p>Suppression définitive</p>
    <div style="display:flex;gap:12px;margin-top:16px">
      <button id="confirmDelete" style="background:#ff69b4;color:#fff">Supprimer</button>
      <button onclick="closeDelete()">Annuler</button>
    </div>
  </div>
</div>

<script>
const supabase = supabase.createClient(
  "https://jyhbamdcxmpveujjqjla.supabase.co",
  "sb_publishable_sqsxb-3Kl5o3-JQYv9kGFw_-g0EgwMa"
);

const gallery = document.getElementById("gallery");
const zoomModal = document.getElementById("zoomModal");
const zoomImg = document.getElementById("zoomImg");
const thumbs = document.getElementById("thumbs");
const deleteModal = document.getElementById("deleteModal");
const confirmDelete = document.getElementById("confirmDelete");

let deleteTarget = null;

/* LOAD */
async function load(){
  gallery.innerHTML = "";

  const { data, error } = await supabase
    .from("creations")
    .select("*")
    .order("created_at",{ascending:false});

  if(error || !data || data.length===0){
    gallery.innerHTML="<p style='color:white'>Aucune image</p>";
    return;
  }

  data.forEach(c=>{
    if(!c.image_path) return;

    const url =
      "https://jyhbamdcxmpveujjqjla.supabase.co/storage/v1/object/public/images/"
      + c.image_path;

    const card = document.createElement("div");
    card.className="card";

    const img = document.createElement("img");
    img.src = url;
    img.onerror = ()=>card.remove();

    img.onclick = ()=>openZoom(url);

    const del = document.createElement("div");
    del.className="delete-btn";
    del.textContent="×";
    del.onclick=(e)=>{
      e.stopPropagation();
      deleteTarget=c;
      deleteModal.style.display="flex";
    };

    card.appendChild(img);
    card.appendChild(del);
    gallery.appendChild(card);
  });
}

/* ZOOM */
function openZoom(src){
  zoomImg.src=src;
  thumbs.innerHTML="";
  zoomModal.style.display="flex";
}

function closeZoom(e){
  if(!e || e.target===zoomModal)
    zoomModal.style.display="none";
}

/* DELETE */
confirmDelete.onclick = async ()=>{
  await supabase.storage.from("images").remove([deleteTarget.image_path]);
  await supabase.from("creations").delete().eq("id",deleteTarget.id);
  deleteModal.style.display="none";
  load();
};

function closeDelete(e){
  if(!e || e.target===deleteModal)
    deleteModal.style.display="none";
}

load();
</script>

</body>
</html>
