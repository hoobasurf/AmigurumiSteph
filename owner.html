<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:'Comic Sans MS',cursive}

/* BODY */
body{
  background:url('Photoroom_20251212_143703.PNG') center top / cover no-repeat fixed;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

/* BOUTONS VUE */
#viewSelector{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-top:20px;
  margin-bottom:20px;
}
#viewSelector button{
  background:#fff0f7;
  border:2px solid #b84c6f;
  color:#b84c6f;
  padding:8px 16px;
  border-radius:24px;
  cursor:pointer;
}

/* CONTENU */
.center-zone{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  width:100%;
  overflow:auto;
}
#visitor-list{
  display:flex;
  justify-content:center;
  gap:16px;
  max-width:1200px;
}

/* ITEMS */
.visitor-item{text-align:center;position:relative;}
.visitor-item img{
  width:220px;
  height:220px;
  object-fit:contain;
  border:4px solid #b67385;
  background:#ffe6f0;
  cursor:pointer;
}
.visitor-item p{
  margin-top:8px;
  font-size:20px;
  color:#b84c6f;
  font-weight:bold;
}

/* VUES */
.carousel-view{flex-wrap:nowrap;overflow-x:auto}
.grid-view{flex-wrap:wrap}
.list-view{flex-direction:column}

/* SIDEBAR */
#sidebar{
  position:fixed;
  top:0;
  left:-220px;
  width:220px;
  height:100vh;
  background:rgba(255,230,240,0.2);
  border-right:2px solid #b67385;
  padding:20px;
  transition:left .3s;
  z-index:10;
}
#sidebar.sidebar-open{left:0}
#toggleSidebar{
  position:absolute;
  top:50%;
  right:-30px;
  width:30px;
  height:60px;
  background:#ffb6c1;
  border-radius:0 12px 12px 0;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
#sidebar button{
  width:100%;
  margin-top:10px;
  padding:10px;
  border-radius:12px;
  border:none;
  background:#ffb6c1;
  cursor:pointer;
  font-weight:bold;
}

/* MODAL ZOOM */
.zoom-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.7);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
}
.zoom-box{
  background:#ffe6f0;
  padding:20px;
  border-radius:18px;
  border:4px solid #b67385;
  position:relative;
  max-width:80%;
  max-height:80%;
  display:flex;
  flex-direction:column;
  align-items:center;
}
.zoom-box img.main{
  width:400px;
  height:400px;
  object-fit:contain;
  border:4px solid #b67385;
  margin-bottom:10px;
}
.zoom-box .miniatures{
  display:flex;
  gap:8px;
  margin-bottom:10px;
}
.zoom-box .miniatures img{
  width:80px;
  height:80px;
  object-fit:contain;
  border:2px solid #b67385;
  cursor:pointer;
}
.zoom-box .close-modal{
  position:absolute;
  top:8px;
  right:8px;
  width:28px;
  height:28px;
  background:pink;
  color:black;
  font-weight:bold;
  font-size:18px;
  border-radius:50%;
  text-align:center;
  line-height:28px;
  cursor:pointer;
  z-index:100;
}
.zoom-box .actions{
  display:flex;
  gap:12px;
  margin-bottom:8px;
}
.zoom-box button.action-btn{
  background:#ffb6c1;
  border:none;
  padding:6px 12px;
  border-radius:12px;
  cursor:pointer;
  font-weight:bold;
  transition: transform 0.2s;
}
.zoom-box button.action-btn:active{
  transform: scale(1.2);
}
.zoom-box .comments{
  width:100%;
  max-height:120px;
  overflow:auto;
  background:#fff0f7;
  border:1px solid #b67385;
  border-radius:12px;
  padding:6px;
}

/* MODAL AJOUT */
.add-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.7);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9998;
}
.add-box{
  background:#ffe6f0;
  padding:20px;
  border-radius:18px;
  border:4px solid #b67385;
  position:relative;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.add-box input[type="file"]{
  cursor:pointer;
}
.add-box .close-modal{
  position:absolute;
  top:8px;
  right:8px;
  width:28px;
  height:28px;
  background:pink;
  color:black;
  font-weight:bold;
  font-size:18px;
  border-radius:50%;
  text-align:center;
  line-height:28px;
  cursor:pointer;
  z-index:100;
}
</style>
</head>
<body>

<div id="viewSelector">
  <button id="btnCarousel">Carrousel</button>
  <button id="btnGrid">Grille</button>
  <button id="btnList">Liste</button>
</div>

<div class="center-zone">
  <div id="visitor-list"></div>
</div>

<div id="sidebar">
  <div id="toggleSidebar">‚ò∞</div>
  <button id="add">Ajouter</button>
  <button onclick="openThemeModal()">Th√®me</button>
</div>

<!-- MODAL AJOUT -->
<div class="add-modal" id="addModal">
  <div class="add-box">
    <span class="close-modal" id="closeAddModal">√ó</span>
    <input type="text" id="modalName" placeholder="Nom">
    <input type="file" id="modalPhotos" multiple accept="image/*">
    <button id="modalUpload">Valider</button>
  </div>
</div>

<!-- MODAL ZOOM -->
<div class="zoom-modal" id="zoomModal">
  <div class="zoom-box">
    <span class="close-modal" id="closeZoomModal">√ó</span>
    <img src="" class="main" id="zoomMain">
    <div class="miniatures" id="miniatures"></div>
    <div class="actions">
      <button class="action-btn" id="likeBtn">‚ù§Ô∏è Like</button>
      <button class="action-btn" id="commentBtn">üí¨ Commentaire</button>
    </div>
    <div class="comments" id="comments"></div>
  </div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
const supabase = createClient(
  "https://jyhbamdcxmpveujjqjla.supabase.co",
  "sb_publishable_sqsxb-3Kl5o3-JQYv9kGFw_-g0EgwMa"
);

let creations = [];
let currentView='grid';
const list=document.getElementById('visitor-list');

// ------------------ LOAD ------------------
async function loadCreations(){
  const { data, error } = await supabase.from("creations").select("*").order("created_at",{ascending:false});
  if(error){console.error(error); return;}
  creations = data.map(c=>{
    const publicUrl = `https://jyhbamdcxmpveujjqjla.supabase.co/storage/v1/object/public/images/${c.image_path}`;
    return { name:c.name, imgUrl:publicUrl, id:c.id };
  });
  renderCreations();
}

function renderCreations(){
  list.innerHTML='';
  list.className=currentView+'-view';
  creations.forEach(c=>{
    const d=document.createElement('div');
    d.className='visitor-item';
    d.innerHTML=`<p>${c.name}</p><img src="${c.imgUrl}" data-id="${c.id}">`;
    list.appendChild(d);
  });
}

// ------------------ SIDEBAR ------------------
document.getElementById('toggleSidebar').onclick = ()=>{document.getElementById('sidebar').classList.toggle('sidebar-open');};
document.getElementById('btnCarousel').onclick = ()=>{currentView='carousel';renderCreations();};
document.getElementById('btnGrid').onclick = ()=>{currentView='grid';renderCreations();};
document.getElementById('btnList').onclick = ()=>{currentView='list';renderCreations();};

// ------------------ MODAL AJOUT ------------------
const addModal=document.getElementById('addModal');
document.getElementById('add').onclick = ()=>{addModal.style.display='flex';};
document.getElementById('closeAddModal').onclick = ()=>{addModal.style.display='none';};
addModal.onclick = (e)=>{if(e.target===addModal) addModal.style.display='none';};

// ------------------ MODAL ZOOM ------------------
const zoomModal=document.getElementById('zoomModal');
const zoomMain=document.getElementById('zoomMain');
const miniatures=document.getElementById('miniatures');
const commentsDiv=document.getElementById('comments');
let currentZoomPhotos=[];

list.addEventListener('click', e=>{
  if(e.target.tagName==='IMG'){
    const id=e.target.dataset.id;
    const item=creations.find(c=>c.id===id);
    currentZoomPhotos=[item];
    zoomMain.src=item.imgUrl;
    miniatures.innerHTML='';
    // Ici on peut ajouter d'autres images si tu veux en r√©cup√©rer plusieurs depuis Supabase
    zoomModal.style.display='flex';
    commentsDiv.innerHTML='';
  }
});
document.getElementById('closeZoomModal').onclick = ()=>{zoomModal.style.display='none';};
zoomModal.onclick = e=>{if(e.target===zoomModal) zoomModal.style.display='none';};

// ------------------ AJOUTER PHOTOS ------------------
document.getElementById('modalUpload').onclick = async ()=>{
  const files = document.getElementById('modalPhotos').files;
  const name = document.getElementById('modalName').value.trim();
  if(!name || files.length===0){alert('Nom + photos requises'); return;}
  
  for(let f of files){
    const path=`${Date.now()}_${f.name}`;
    const { error } = await supabase.storage.from("images").upload(path,f);
    if(error){alert(error.message); continue;}
    await supabase.from("creations").insert([{name,image_path:path}]);
    const publicUrl=`https://jyhbamdcxmpveujjqjla.supabase.co/storage/v1/object/public/images/${path}`;
    creations.unshift({name,imgUrl:publicUrl, id:Date.now()}); // ID temporaire
  }
  renderCreations();
  addModal.style.display='none';
  document.getElementById('modalPhotos').value='';
  document.getElementById('modalName').value='';
};

// ------------------ LIKE & COMMENT ------------------
document.getElementById('likeBtn').onclick = ()=>{
  const prenom = prompt("Ton pr√©nom pour le Like ?");
  if(prenom) commentsDiv.innerHTML += `<p>‚ù§Ô∏è ${prenom} a lik√©</p>`;
};
document.getElementById('commentBtn').onclick = ()=>{
  const comment = prompt("Ton commentaire ?");
  if(comment) commentsDiv.innerHTML += `<p>üí¨ ${comment}</p>`;
};

loadCreations();
</script>
</body>
</html>
