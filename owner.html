<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ====== STYLE IDENTIQUE √Ä TON CODE ====== */
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;font-family:'Comic Sans MS',cursive;overflow-x:hidden;}
body::before{
  content:"";position:fixed;inset:0;
  background:url('Photoroom_20251223_114401.jpeg') center/cover no-repeat;
  z-index:-1;
}
.center-zone{display:flex;justify-content:center;padding-top:3.5cm;}
#visitor-list-container{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;padding-left:1cm;}
.page{
  display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(3,1fr);
  gap:4mm;width:410px;height:610px;scroll-snap-align:center;padding:4mm;
}
.visitor-item{
  position:relative;width:200px;height:200px;border-radius:12px;overflow:hidden;
  border:3px solid #fff;background:#ffe6f0;
}
.visitor-item img{width:100%;height:100%;object-fit:cover;cursor:pointer;}
.delete-btn{
  position:absolute;top:4px;right:4px;width:20px;height:20px;
  background:#ffb6c1;color:#fff;border-radius:50%;
  display:flex;align-items:center;justify-content:center;cursor:pointer;
}
.visitor-item p{
  position:absolute;bottom:4px;width:100%;text-align:center;
  color:#b84c6f;font-weight:bold;font-size:14px;
}
.actions{
  position:absolute;bottom:28px;width:100%;
  display:flex;justify-content:center;gap:14px;
}
.like-btn,.comment-btn{
  background:none;border:none;cursor:pointer;
  display:flex;align-items:center;gap:6px;
  color:#b84c6f;font-weight:bold;
}
.like-btn svg,.comment-btn svg{width:16px;height:16px;stroke:#ffb6c1;fill:none}

/* SIDEBAR */
#sidebar{position:fixed;top:0;left:-220px;width:220px;height:100vh;
  background:rgba(255,230,240,.9);transition:.3s;padding:20px;z-index:10;}
#sidebar.sidebar-open{left:0}
#toggleSidebar{
  position:absolute;right:-30px;top:50%;
  width:30px;height:60px;background:#ffb6c1;
  display:flex;align-items:center;justify-content:center;cursor:pointer;
}

/* MODALS */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;justify-content:center;align-items:center;z-index:10000;}
.modal-box{
  background:#ffe6f0;border-radius:20px;padding:16px;
  display:flex;flex-direction:column;gap:10px;min-width:220px;
}
.modal input, .modal button{
  padding:6px;border-radius:10px;border:2px solid #b67385;
}
.modal button{background:#ffb6c1;color:#fff;font-weight:bold;cursor:pointer}

/* BUBBLES */
.bubble-container{display:flex;gap:6px;flex-wrap:wrap}
.bubble{background:#ffd6e4;padding:4px 8px;border-radius:12px;font-size:12px}

/* ZOOM */
#zoomModal{position:fixed;inset:0;background:rgba(0,0,0,.7);
  display:none;flex-direction:column;align-items:center;justify-content:center;}
#zoomModal img{max-width:80%;max-height:60vh;border-radius:20px;}
.closeZoom{position:absolute;top:12px;right:12px;background:#ffb6c1;
  width:28px;height:28px;border-radius:50%;display:flex;align-items:center;
  justify-content:center;cursor:pointer;color:#fff;font-size:18px}
</style>
</head>

<body>

<div class="center-zone">
  <div id="visitor-list-container"></div>
</div>

<div id="sidebar">
  <div id="toggleSidebar">‚ò∞</div>
  <button id="addBtn">Ajouter</button>
</div>

<!-- MODALS -->
<div id="addModal" class="modal"><div class="modal-box">
  <input id="photoName" placeholder="Nom">
  <input type="file" id="multiPhoto" multiple>
  <button id="confirmAdd">Valider</button>
</div></div>

<div id="deleteModal" class="modal"><div class="modal-box">
  <p>Supprimer ?</p>
  <button id="confirmDelete">Oui</button>
  <button id="cancelDelete">Annuler</button>
</div></div>

<div id="likeModal" class="modal"><div class="modal-box">
  <input id="likeName" placeholder="Pr√©nom">
  <button id="confirmLike">Valider</button>
  <div id="likeBubbles" class="bubble-container"></div>
</div></div>

<div id="commentModal" class="modal"><div class="modal-box">
  <input id="commentName" placeholder="Pr√©nom">
  <input id="commentText" placeholder="Commentaire">
  <button id="confirmComment">Valider</button>
  <div id="commentBubbles" class="bubble-container"></div>
</div></div>

<div id="zoomModal">
  <div class="closeZoom">√ó</div>
  <img id="mainZoom">
  <div class="actions">
    <button class="like-btn">
      ‚ù§Ô∏è <span id="likeCount">0</span>
    </button>
    <button class="comment-btn">
      üí¨ <span id="commentCount">0</span>
    </button>
  </div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
 "https://jyhbamdcxmpveujjqjla.supabase.co",
 "sb_publishable_sqsxb-3Kl5o3-JQYv9kGFw_-g0EgwMa"
);

let creations=[], currentZoom=null, currentDelete=null;
const container=document.getElementById('visitor-list-container');

/* ===== RENDER ===== */
function render(){
 container.innerHTML='';
 let page;
 creations.forEach((c,i)=>{
  if(i%6===0){page=document.createElement('div');page.className='page';container.appendChild(page);}
  const d=document.createElement('div');
  d.className='visitor-item';
  d.innerHTML=`
   <div class="delete-btn">√ó</div>
   <img src="${c.imgUrl}">
   <p>${c.name}</p>
   <div class="actions">
    <button class="like-btn">‚ù§Ô∏è</button>
    <button class="comment-btn">üí¨</button>
   </div>`;
  d.querySelector('img').onclick=()=>openZoom(c);
  d.querySelector('.delete-btn').onclick=()=>{currentDelete=c;deleteModal.style.display='flex'};
  d.querySelector('.like-btn').onclick=e=>{e.stopPropagation();openLike(c)};
  d.querySelector('.comment-btn').onclick=e=>{e.stopPropagation();openComment(c)};
  page.appendChild(d);
 });
}

/* ===== ZOOM ===== */
function openZoom(c){
 currentZoom=c;
 mainZoom.src=c.imgUrl;
 updateCounts();
 zoomModal.style.display='flex';
}

/* ===== LIKE / COMMENT ===== */
function updateCounts(){
 likeCount.textContent=currentZoom.likes.length;
 commentCount.textContent=currentZoom.comments.length;
}

function openLike(c){
 currentZoom=c;
 likeBubbles.innerHTML='';
 c.likes.forEach(n=>likeBubbles.innerHTML+=`<div class="bubble">${n}</div>`);
 likeModal.style.display='flex';
}

function openComment(c){
 currentZoom=c;
 commentBubbles.innerHTML='';
 c.comments.forEach(o=>commentBubbles.innerHTML+=`<div class="bubble"><b>${o.name}</b> ${o.text}</div>`);
 commentModal.style.display='flex';
}

/* ===== EVENTS ===== */
toggleSidebar.onclick=()=>sidebar.classList.toggle('sidebar-open');
closeZoom.onclick=()=>zoomModal.style.display='none';
zoomModal.onclick=e=>e.target===zoomModal&&(zoomModal.style.display='none');
likeModal.onclick=e=>e.target===likeModal&&(likeModal.style.display='none');
commentModal.onclick=e=>e.target===commentModal&&(commentModal.style.display='none');

/* ===== CONFIRM ===== */
confirmLike.onclick=async()=>{
 const n=likeName.value.trim(); if(!n)return;
 currentZoom.likes.push(n);
 await supabase.from('creations').update({likes:currentZoom.likes}).eq('id',currentZoom.id);
 openLike(currentZoom); updateCounts(); likeName.value='';
};

confirmComment.onclick=async()=>{
 const n=commentName.value.trim(), t=commentText.value.trim();
 if(!n||!t)return;
 currentZoom.comments.push({name:n,text:t});
 await supabase.from('creations').update({comments:currentZoom.comments}).eq('id',currentZoom.id);
 openComment(currentZoom); updateCounts(); commentName.value=''; commentText.value='';
};

/* ===== LOAD ===== */
async function load(){
 const {data}=await supabase.from('creations').select('*').order('created_at',{ascending:false});
 creations=data.map(c=>({
  id:c.id,name:c.name,
  imgUrl:supabase.storage.from('images').getPublicUrl(c.image_path).data.publicUrl,
  likes:c.likes||[],comments:c.comments||[]
 }));
 render();
}
load();
</script>
</body>
</html>
