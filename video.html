<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mes Vid√©os</title>
<style>
html, body {
  margin:0; padding:0;
  font-family:'Comic Sans MS',cursive;
  background:#ffe6f0;
  height:100%;
}

/* FOND IMAGE */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background-image:url('IMG_1722.jpeg');
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  z-index:-1;
}

/* SIDEBAR */
#sidebar{
  position:fixed; top:0; left:-220px;
  width:220px; height:100vh;
  background:#ffe6f0;
  border-right:2px solid #b67385;
  padding:20px;
  transition:left .3s;
  z-index:100;
}
#sidebar.sidebar-open{left:0;}
#toggleSidebar{
  position:absolute; top:50%; right:-30px;
  width:30px; height:60px;
  background:#ffb6c1;
  border-radius:0 12px 12px 0;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; font-weight:bold; color:white;
}
#backBtn{
  width:100%; padding:8px;
  border-radius:16px; border:none;
  background:#ffb6c1; color:white; font-weight:bold;
  cursor:pointer; margin-top:10px;
}

/* MAIN CONTENU */
main{
  margin-left:20px; padding:10px;
}

/* INPUTS + BOUTONS */
input[type="file"], input[type="text"]{
  width: calc(100% - 10px);
  padding:8px;
  margin-bottom:8px;
  border-radius:12px;
  border:2px solid #b67385;
  outline:none;
}
button{
  padding:6px 12px;
  border:none;
  border-radius:12px;
  background:#ffb6c1;
  color:white;
  cursor:pointer;
  margin-bottom:8px;
}

/* LISTE VIDEOS */
#videoList{
  display:flex; flex-direction: column;
  gap:10px; margin-top:10px;
}
.video-item{
  background:rgba(255,182,193,0.4);
  padding:8px; border-radius:12px;
  display:flex; align-items:center; justify-content:space-between;
  cursor:pointer; transition: background 0.2s;
}
.video-item:hover{background:rgba(255,182,193,0.6);}
.video-item span{flex:1; margin-left:6px;}

/* VIDEO + TRANSCRIPTION */
#currentVideo{
  margin-top:10px; display:flex; flex-direction: column; gap:6px;
}
#currentVideo iframe, #currentVideo video{
  width:100%; height:240px; border-radius:12px;
}
#transcription{
  background:rgba(255,182,193,0.2);
  padding:6px; border-radius:12px;
  max-height:150px; overflow-y:auto;
  font-size:14px; line-height:1.4;
}
.highlight{background:rgba(255,182,193,0.5);}
</style>
</head>
<body>

<!-- SIDEBAR -->
<div id="sidebar">
  <div id="toggleSidebar">‚ò∞</div>
  <button id="backBtn">Retour</button>
</div>

<main>
  <h2>Ajouter une vid√©o</h2>
  <input type="file" id="fileInput" accept="video/*">
  <input type="text" id="youtubeUrl" placeholder="Coller URL YouTube">
  <button id="addYoutubeBtn">Ajouter YouTube</button>

  <h2>Mes vid√©os</h2>
  <div id="videoList"></div>

  <div id="currentVideo">
    <div id="transcription">Transcription de la vid√©o s'affichera ici.</div>
  </div>
</main>

<script>
let videos = [];
let currentVideo = null;

// SIDEBAR
document.getElementById('toggleSidebar').onclick = () => {
  document.getElementById('sidebar').classList.toggle('sidebar-open');
};
document.getElementById('backBtn').onclick = () => {
  document.body.style.transition='opacity 0.5s';
  document.body.style.opacity='0';
  setTimeout(()=>{window.location.href='owner.html';},500);
};

// AJOUTER FICHIER LOCAL
document.getElementById('fileInput').onchange = async (e)=>{
  const file=e.target.files[0];
  if(!file) return;
  const url=URL.createObjectURL(file);
  
  // Appel au serveur pour transcription automatique
  const transcription = await fakeTranscription(file.name); // √† remplacer par serveur r√©el
  addVideo({name:file.name,type:'file',url, transcription});
  e.target.value='';
};

// AJOUTER YOUTUBE
document.getElementById('addYoutubeBtn').onclick=async ()=>{
  const url=document.getElementById('youtubeUrl').value.trim();
  if(!url) return alert("URL vide !");
  let id;
  if(url.includes('youtu.be/')) id=url.split('youtu.be/')[1];
  else if(url.includes('v=')) id=url.split('v=')[1].split('&')[0];
  else id=url.split('/').pop();
  
  const transcription = await fakeTranscription('YouTube Video'); // simulation serveur
  addVideo({name:'YouTube Video', type:'youtube', id, url:'https://www.youtube.com/embed/'+id, transcription});
  document.getElementById('youtubeUrl').value='';
};

// AJOUTER VIDEO
function addVideo(video){
  videos.push(video);
  renderList();
  openVideo(video);
}

// RENDER LISTE
function renderList(){
  const list=document.getElementById('videoList');
  list.innerHTML='';
  videos.forEach((v,i)=>{
    const div=document.createElement('div');
    div.className='video-item';

    const span=document.createElement('span');
    span.textContent=v.name;
    div.appendChild(span);

    const renameBtn=document.createElement('button');
    renameBtn.textContent='‚úèÔ∏è';
    renameBtn.onclick=(e)=>{
      e.stopPropagation();
      const newName=prompt("Nouveau nom :",v.name);
      if(newName){ v.name=newName; span.textContent=newName; }
    };
    div.appendChild(renameBtn);

    const delBtn=document.createElement('button');
    delBtn.textContent='üóëÔ∏è';
    delBtn.onclick=(e)=>{
      e.stopPropagation();
      videos.splice(i,1);
      renderList();
      if(v===currentVideo){
        document.getElementById('currentVideo').innerHTML='<div id="transcription">Transcription de la vid√©o s\'affichera ici.</div>';
      }
    };
    div.appendChild(delBtn);

    div.onclick=()=> openVideo(v);
    list.appendChild(div);
  });
}

// OUVRIR VIDEO + TRANSCRIPTION
function openVideo(v){
  currentVideo=v;
  const container=document.getElementById('currentVideo');
  container.innerHTML='';

  let videoElem;
  if(v.type==='file'){
    videoElem=document.createElement('video');
    videoElem.src=v.url; videoElem.controls=true;
    videoElem.ontimeupdate = ()=>syncTranscription(videoElem, v.transcription);
  } else {
    videoElem=document.createElement('iframe');
    videoElem.src=v.url;
    videoElem.frameBorder='0';
    videoElem.allow='accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
    videoElem.allowFullscreen=true;
  }
  container.appendChild(videoElem);

  const trans=document.createElement('div');
  trans.id='transcription';
  trans.textContent=v.transcription;
  container.appendChild(trans);
}

// SIMULATION TRANSCRIPTION (√† remplacer par serveur r√©el)
async function fakeTranscription(name){
  // renvoie chaque mot s√©par√© par espace pour simuler surlignage
  return name + " : Ceci est une transcription automatique de la vid√©o pour test. Chaque mot appara√Ætra en surlignage pendant la lecture.";
}

// SYNC TRANSCRIPTION
function syncTranscription(videoElem, transcription){
  const words=transcription.split(' ');
  const time=Math.floor(videoElem.currentTime); // simulation: 1 mot par seconde
  const container=document.getElementById('transcription');
  container.innerHTML='';
  for(let i=0;i<words.length;i++){
    const span=document.createElement('span');
    span.textContent=words[i]+' ';
    if(i===time) span.className='highlight';
    container.appendChild(span);
  }
}
</script>
</body>
</html>
