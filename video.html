<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mes vidéos</title>

<style>
body {
  font-family: Comic Sans MS, cursive;
  background:#fff0f6;
  padding:20px;
}

#video-list {
  max-width:400px;
  margin:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.video-item {
  background:#ffe6f0;
  border:2px solid #b67385;
  border-radius:12px;
  padding:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.video-item button {
  background:#ffb6c1;
  border:none;
  color:white;
  border-radius:10px;
  padding:4px 8px;
  font-weight:bold;
  cursor:pointer;
}

.modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
}

.modal-content {
  background:#fff0f6;
  padding:20px;
  border-radius:12px;
  width:90%;
  max-width:400px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

input {
  padding:8px;
  border-radius:8px;
  border:2px solid #b67385;
}

iframe {
  width:100%;
  height:220px;
  border-radius:8px;
}
</style>
</head>

<body>

<h2 style="text-align:center;">Mes vidéos</h2>

<div style="text-align:center;margin-bottom:15px;">
  <button id="addVideoBtn">➕ Ajouter vidéo</button>
</div>

<div id="video-list"></div>

<!-- MODAL AJOUT -->
<div class="modal" id="addModal">
  <div class="modal-content">
    <h3>Ajouter une vidéo YouTube</h3>
    <input id="youtubeInput" placeholder="Lien YouTube">
    <button id="confirmAdd">Ajouter</button>
    <button onclick="closeAdd()">Annuler</button>
  </div>
</div>

<!-- MODAL PLAYER -->
<div class="modal" id="playModal">
  <div class="modal-content" id="playContent"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabase = supabaseJs.createClient(
  "https://jyhbamdcxmpveujjqjla.supabase.co",
  "sb_publishable_sqsxb-3Kl5o3-JQYv9kGFw_-g0EgwMa"
);

const videoList = document.getElementById("video-list");
const addModal = document.getElementById("addModal");
const youtubeInput = document.getElementById("youtubeInput");
const playModal = document.getElementById("playModal");
const playContent = document.getElementById("playContent");

document.getElementById("addVideoBtn").onclick = () => {
  addModal.style.display = "flex";
};

function closeAdd(){
  addModal.style.display = "none";
  youtubeInput.value = "";
}

document.getElementById("confirmAdd").onclick = async () => {
  const yt = youtubeInput.value.trim();
  if(!yt){ alert("Lien manquant"); return; }

  const { error } = await supabase
    .from("videos")
    .insert([{ name:"Vidéo YouTube", youtubelink: yt }]);

  if(error){
    alert(error.message);
    return;
  }

  closeAdd();
  loadVideos();
};

async function loadVideos(){
  const { data, error } = await supabase
    .from("videos")
    .select("*")
    .order("created_at",{ascending:false});

  if(error){ console.error(error); return; }

  videoList.innerHTML = "";

  data.forEach(v => {
    const div = document.createElement("div");
    div.className = "video-item";

    const span = document.createElement("span");
    span.textContent = v.name;

    const openBtn = document.createElement("button");
    openBtn.textContent = "Ouvrir";
    openBtn.onclick = () => openVideo(v);

    const renameBtn = document.createElement("button");
    renameBtn.textContent = "✏️";
    renameBtn.onclick = async () => {
      const newName = prompt("Nouveau nom :", v.name);
      if(!newName) return;

      const { error } = await supabase
        .from("videos")
        .update({ name:newName })
        .eq("id", v.id);

      if(error){ alert(error.message); return; }
      loadVideos();
    };

    div.appendChild(span);
    div.appendChild(openBtn);
    div.appendChild(renameBtn);
    videoList.appendChild(div);
  });
}

function openVideo(v){
  playContent.innerHTML = "";

  const closeBtn = document.createElement("button");
  closeBtn.textContent = "Fermer";
  closeBtn.onclick = () => playModal.style.display="none";

  playContent.appendChild(closeBtn);

  let ytId = null;
  const m1 = v.youtubelink.match(/watch\?v=([^&]+)/);
  const m2 = v.youtubelink.match(/youtu\.be\/([^?&]+)/);
  if(m1) ytId = m1[1];
  if(m2) ytId = m2[1];

  if(ytId){
    const iframe = document.createElement("iframe");
    iframe.src = "https://www.youtube.com/embed/" + ytId;
    iframe.allowFullscreen = true;
    playContent.appendChild(iframe);
  } else {
    playContent.appendChild(document.createTextNode("Lien invalide"));
  }

  playModal.style.display = "flex";
}

playModal.onclick = e => {
  if(e.target === playModal) playModal.style.display="none";
};

loadVideos();
</script>
</body>
</html>
