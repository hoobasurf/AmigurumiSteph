<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mes créations</title>

<style>
body {
  margin: 0;
  font-family: 'Comic Sans MS', cursive;
}

#visitor-list {
  display: flex;
  gap: 24px;
  padding: 20px;
  overflow-x: auto;
}

.visitor-item {
  text-align: center;
  cursor: pointer;
}

.visitor-item img {
  width: 240px;
  height: 240px;
  object-fit: contain;
  display: block;
}

.visitor-item p {
  margin-top: 8px;
  color: #b84c6f;
  font-weight: bold;
}
</style>
</head>

<body>

<h1 style="text-align:center;color:#b84c6f;">Mes créations</h1>
<div id="visitor-list"></div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* =============================
   SUPABASE CONFIG
============================= */
const SUPABASE_URL = "https://iubbxvipgofxasatmvzg.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_GDoZmwIdoP28XOdrfYYVNw_E_HiCQB1";

const supabase = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

/* =============================
   ELEMENTS
============================= */
const list = document.getElementById("visitor-list");

/* =============================
   LOAD CREATIONS (SAFE)
============================= */
async function loadCreations() {
  const { data, error } = await supabase
    .storage
    .from("owners")
    .list("", {
      limit: 200,
      sortBy: { column: "name", order: "asc" }
    });

  if (error) {
    console.error("Erreur storage:", error);
    return;
  }

  const creations = data
    .filter(file => file.name && !file.name.startsWith("."))
    .map(file => ({
      name: file.name,
      url: supabase
        .storage
        .from("owners")
        .getPublicUrl(file.name)
        .data.publicUrl
    }));

  render(creations);
}

/* =============================
   RENDER
============================= */
function render(creations) {
  list.innerHTML = "";

  creations.forEach(item => {
    const div = document.createElement("div");
    div.className = "visitor-item";

    div.innerHTML = `
      <img src="${item.url}" alt="">
      <p>${item.name}</p>
    `;

    list.appendChild(div);
  });
}

/* =============================
   INIT
============================= */
loadCreations();
</script>

</body>
</html>
