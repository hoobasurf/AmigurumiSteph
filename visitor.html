<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Galerie â€“ Visitor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ================= RESET ================= */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:sans-serif;
  background:#fff0f5;
  overflow-x:hidden;
}

/* ================= CACHE Lâ€™APPLI AU DÃ‰PART ================= */
body.app{
  visibility:hidden;
}
body.app.ready{
  visibility:visible;
}

/* ================= FOND BIENVENUE ================= */
#intro-background{
  position:fixed;
  inset:0;
  background:url('Photoroom_20251213_123235.png') center/cover no-repeat;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:100000;
}

#startBtn{
  padding:20px 40px;
  font-size:24px;
  border-radius:16px;
  border:none;
  background:#ffb6c1;
  color:#8b3a3a;
  font-weight:bold;
  cursor:pointer;
  box-shadow:0 6px 15px rgba(182,115,133,.3);
}

/* ================= INTRO VIDEO ================= */
#intro-video{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:100001;
  opacity:0;
  pointer-events:none;
  transition:opacity 1s ease;
}

#intro-video video{
  width:100%;
  height:100%;
  object-fit:cover;
  pointer-events:none;
}

/* ================= HEADER ================= */
h1{
  text-align:center;
  color:#b84c6f;
  margin:20px 0;
}

/* ================= MODES ================= */
#viewSelector{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-bottom:10px;
}
#viewSelector button{
  padding:8px 16px;
  border-radius:20px;
  border:2px solid #b84c6f;
  background:#fff0f7;
  color:#b84c6f;
  font-weight:bold;
  cursor:pointer;
}
#viewSelector button.active{
  background:#ffeaf2;
}

/* ================= LISTE ================= */
#visitor-list{
  width:100%;
  max-width:1200px;
  margin:0 auto;
  padding:10px;
}

.carousel-view{
  display:flex;
  gap:20px;
  overflow-x:auto;
}
.grid-view{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:20px;
}
.list-view{
  display:flex;
  flex-direction:column;
  gap:20px;
}

.visitor-item{
  text-align:center;
  cursor:pointer;
}
.visitor-item img{
  width:100%;
  max-height:240px;
  object-fit:contain;
  border:4px solid #b67385;
  border-radius:12px;
}
.visitor-item p{
  margin-top:8px;
  font-weight:bold;
  color:#b84c6f;
}
</style>
</head>

<body class="app">

<!-- BIENVENUE -->
<div id="intro-background">
  <button id="startBtn">Bienvenue</button>
</div>

<!-- VIDEO -->
<div id="intro-video">
  <video id="video" muted playsinline preload="auto">
    <source src="chat.mp4" type="video/mp4">
  </video>
</div>

<!-- APP -->
<h1>âœ¨ Projets rÃ©alisÃ©s</h1>

<div id="viewSelector">
  <button id="btnCarousel" class="active">Carrousel</button>
  <button id="btnGrid">Grille</button>
  <button id="btnList">Liste</button>
</div>

<div id="visitor-list"></div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<script>
/* ================= SUPABASE ================= */
const SUPABASE_URL = "https://iubbxvipgofxasatmvzg.supabase.co";
const SUPABASE_KEY = "sb_publishable_GDoZmwIdoP28XOdrfYYVNw_E_HiCQB1";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const list = document.getElementById("visitor-list");
let creations = [];
let view = "carousel";

/* CHARGEMENT DES IMAGES */
async function loadCreations(){
  const { data, error } = await supabase.storage.from("owners").list();
  if(error){ console.error(error); return; }

  creations = data.map(f => ({
    name: f.name,
    url: supabase.storage.from("owners").getPublicUrl(f.name).publicURL
  }));

  render();
}

function render(){
  list.className = view + "-view";
  list.innerHTML = "";
  creations.forEach(c=>{
    const div = document.createElement("div");
    div.className="visitor-item";
    div.innerHTML = `<img src="${c.url}"><p>${c.name}</p>`;
    list.appendChild(div);
  });
}

/* MODES */
btnCarousel.onclick=()=>{view="carousel";setActive(btnCarousel);render();}
btnGrid.onclick=()=>{view="grid";setActive(btnGrid);render();}
btnList.onclick=()=>{view="list";setActive(btnList);render();}

function setActive(btn){
  document.querySelectorAll("#viewSelector button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}

/* ================= INTRO LOGIQUE ================= */
const startBtn=document.getElementById("startBtn");
const introBg=document.getElementById("intro-background");
const introVideo=document.getElementById("intro-video");
const video=document.getElementById("video");

startBtn.onclick=()=>{
  introBg.style.display="none";
  introVideo.style.opacity="1";
  introVideo.style.pointerEvents="auto";
  video.play();
};

video.onended=()=>{
  setTimeout(()=>{
    introVideo.style.opacity="0";
    setTimeout(()=>{
      introVideo.remove();
      document.body.classList.add("ready");
      loadCreations(); // ðŸ”¥ APPLI LANCÃ‰E ICI
    },1000);
  },2000);
};
</script>

</body>
</html>
